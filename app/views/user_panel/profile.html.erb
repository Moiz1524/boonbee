<div class="profile-bg mb-3">
    <div class="profile-bg-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-5">
                    <div class="row">
                        <div class="col-md-5 mb-3">
                           <center> <img src="<%= current_user.profile_pic.url %>" alt="<%= current_user.name %>", class="img-fluid profile-show-image" /></center>
                           <center><%= link_to "Edit Profile", edit_user_registration_path, class: 'btn btn-primary mt-3' %></center>
                        </div>
                        <div class="col-md-7 mt-4">
                            <h3 class="text-light center mb-0"><%= current_user.username %></h3>
                            <p class="text-light center mb-2 small"> <i class="fas fa-map-marker-alt"></i> <%= ( current_user.location  if current_user.location.present? ) || "Your location"%></p>
                            <%= link_to "Start a new campaign", new_campaign_path, class: "btn btn-primary" %>
                        </div>
                    </div>
                </div>
                <div class="col-lg-7"></div>
            </div>
        </div>
    </div>
</div>

<div class="container py-4">
    <div class="col-md-7 mx-auto mb-4">
         <ul class="nav nav-tabs text-center profile-tabs" role="tablist">
          <li class="nav-item font-25">
            <a class="nav-link active profile-tabs-color" href="#about" role="tab" data-toggle="tab" aria-selected="true">Current Request</a>
          </li>
          <li class="nav-item font-25">
            <a class="nav-link profile-tabs-color" href="#contributors" role="tab" data-toggle="tab">Money Given</a>
          </li>
          <li class="nav-item font-25">
            <a class="nav-link profile-tabs-color" href="#campaign" role="tab" data-toggle="tab">Money Gifts Received</a>
          </li>
        </ul>
    </div>
    <div class="col-md-9 mx-auto">
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="about">
                <div class="row">
                    <div class="col-md-12">
                        <%= current_user.bio %>
                    </div>
                </div>
            </div>
          <div role="tabpanel" class="tab-pane fade" id="contributors">
              <table>
                  <tr>
                    <th>Occasion</th>
                    <th>Date</th>
                    <th>Amount</th>
                    <!--<th>View Invoice</th>-->
                  </tr>
                  <% t_amount = 0 %>
                  <% current_user.donations.each do |d| %>
                  <% username = d.campaign.user.username %>
                  <% t_amount = t_amount + d.amount %>
                      <tr>
                        <td><%= link_to("#{username} #{d.campaign.occ_type}", campaign_path(d.campaign)) %></td>
                        <td><%= d.updated_at.strftime('%B %e ,%Y') %></td>
                        <td>$<%= d.amount %></td>
                        <%#= link_to(d.campaign.name, campaign_path(d.campaign)) %>
                        <%#= link_to("View Invoice", Stripe::Charge.retrieve(d.stripe_id).receipt_url, target: :_blank ) if d.stripe_id.present? %>
                      </tr>
                  <% end %>
                  <tr>
                      <td><strong>TOTAL</strong></td>
                      <td></td>
                      <td><strong>$<%= t_amount %></strong></td>
                  </tr>
              </table>
            </div>
          <div role="tabpanel" class="tab-pane fade" id="campaign">
            <% if current_user.campaigns != [] %>
                <% @donations.sort.reverse.each do |d| %>
                <%# if c.donations != [] %>
                  <div class="card my-3">
                 <div class="row">
                     <div class="col-lg-5 col-xl-4 col-md-12">
                         <div class="fund-image" style="background-image:url('<%= d.user.profile_pic.url %>')">
                             <div class="fund-image-overlay px-2">
                                 <div class="campaign-like">
                                     <div class="row">
                                         <div class="col-9">
                                             <%#= c.updated_at.strftime('%B, %y') %>
                                         </div>
                                         <div class="col-3 text-right">
                                               <!--<span class="text-light">1 <i class="far fa-heart"></i></span>-->
                                         </div>
                                     </div>
                                 </div>
                                 <div class="campaign-avatar">
                                     <div class="d-inline-flex">
                                             <!--<div class="avatar mr-2" style="background-image:url('<%#= c.user.profile_pic.url %>')">-->
                                             <!--</div>-->
                                             <!--<div class="ml-1 mt-2">-->
                                             <!--    <p class="text-light mb-0 line-height-9"><%#= c.user.username %></p>-->
                                             <!-- <p class="mb-0 text-light small"><i class="fas fa-map-marker-alt"></i> <%#= c.user.location %></p>-->
                                             <!--</div>-->
                                     </div>
                                 </div>
                             </div>
                         </div>
                     </div>
                     <div class="col-lg-7 col-xl-8 col-md-12">
                         <div class="p-2">
                             <span class="text-dark"><%#= c.name %><%= d.user.username %></span> 
                             <!--<span class="small"><%#= time_ago_in_words(c.updated_at) %> ago</span>-->
                             <%# @amount = 0 %>
                             <%# c.donations.each do |d| %>
                                 <%# @amount = @amount + d.amount %>
                             <%# end %>
                             <p class="p-line-3 my-2"><%= d.user.location %></p>
                             <h1>$<%= d.amount %></h1>
                             
                             <div class="my-2">
                                <div class="progress"></div><br>
                                <small></small>
                                <i>Just a little something for you</i><br>
                                <a href="#">Leave a comment</a>
                             </div>
                             <div class="row align-items-center">
                                 <!--<div class="col-7">-->
                                 <!--    <a class="badge badge-pill badge-primary"><%#= c.occ_type %></a>-->
                                 <!--</div>-->
                                 <div class="col-12">
                                     <div class="btn btn-primary float-right donate-btn">
                                     <%= social_share_button_tag(campaign_path(d.campaign), desc: d.campaign.occ_details, :allow_sites => %w(facebook)) %> Share
                                     </div>
                                 </div>
                                 
                                 
                                 <%# if c.job_flag %>
                                      <%#= link_to("CashOut", root_path, class: "btn btn-primary float-right donate-btn") %>
                                 <%# end %>
                                 <div class="col-5">
                                     <%#= link_to("Received Payments", campaign_funds_path(c), class: 'btn btn-primary') %>
                                     <!--<a href="javascript:void(0)" class="btn btn-primary mb-2" data-toggle="modal" data-target="#received_payments<%#= c.id %>">Received Payments</a>-->
                                     <%#= link_to "Edit", edit_campaign_path(c), class: "btn btn-primary" %>
                                     <%#= link_to 'Show', campaign_path(c), class: 'btn btn-primary'%>
                                     <%#= link_to 'Delete', c, method: :delete, class:'btn btn-primary', data: { confirm: 'Are you sure?' } %>
                                 </div>
                             </div>
                         </div>
                     </div>
                 </div>
                 </div>
             <% end %>

            <% else %>
                <p>You have no campaigns raised!!.</p>
            <% end %>
            </div>
         </div>
     </div>
</div>

<% @campaigns.each do |c| %>
<div class="modal fade" id="received_payments<%=c.id%>" tabindex="-1" role="dialog" aria-labelledby="received_payments_label" aria-hidden="true">
	<div class="modal-dialog text-left modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="received_payments_label">All Payments</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="container">
                  <br>
                  <% funds = 0 %>
                  <% c.donations.each do |d| %>
                      <% funds = funds + d.amount %>
                  <% end %>
                  <% if funds > 0 %>
                      <p>Net Amount: <%= funds %>$</p>
                      <table>   
                        <tr>
                          <th>Receiving Date</th>
                          <th>Payment</th>
                          <th>Paid by</th>
                        </tr>
                        <% c.donations.each do |d| %>
                            <tr>
                              <td><%= d.updated_at.strftime('%B %e ,%Y') %></td>
                              <td><%= d.amount %> $</td>
                              <td><%= d.user.username %></td>
                            </tr>
                        <% end %>
                      </table>
                  <% else %>
                      <p>No results found!.</p>
                  <% end %>
                </div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
			</div>
		</div>
	</div>
</div>
<% end %>